<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Ä°laÃ§larÄ±nÄ± Unutma ğŸ˜ğŸ§¡</title>
  <meta name="description" content="Ä°laÃ§ hatÄ±rlatÄ±cÄ± PWA â€” bildirim, ses, Ã§oklu hatÄ±rlatÄ±cÄ±, TZ seÃ§imi" />
  <meta name="theme-color" content="#ffd1e6" />

  <!-- PWA / GitHub Pages -->
  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="icon" href="./icons/icon-192.png" />
  <link rel="apple-touch-icon" href="./icons/icon-192.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />

  <!-- iOS PWA uyarÄ±sÄ±: web push ayrÄ± altyapÄ± ister; bu app yerel bildirim Ã§alar -->
  <meta name="format-detection" content="telephone=no" />

  <style>
    :root{
      --pink:#ffd1e6; --dark:#2b1f2f; --muted:#6a5a66;
      --accent:#ff6fa3; --accent2:#ff9fc2; --ok:#34c759; --warn:#ff9500; --danger:#ef476f;
      --heart-orange:#ff7f27; /* ğŸ§¡ */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:var(--dark);
      /* Sade degrade + Ã§ok hafif kalp deseni (pembe & turuncu) */
      background:
        radial-gradient(80px 40px at 5% 10%, rgba(255,127,39,.16) 20%, transparent 22%) repeat,
        radial-gradient(80px 40px at 85% 20%, rgba(255,111,163,.16) 20%, transparent 22%) repeat,
        linear-gradient(180deg,#ffe9f1 0%,#ffd1e6 60%,#ffc0d6 100%);
      background-size: 180px 90px, 200px 100px, auto;
    }
    .app{max-width:920px;margin:0 auto;padding:20px}
    .card{background:#fff;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.08);padding:20px;margin:16px 0}
    .title{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
    .brand{font-size:1.55rem;font-weight:900;letter-spacing:.2px}
    .brand .heart{color:var(--heart-orange)} /* baÅŸlÄ±ktaki kalp turuncu */
    .badge{background:#ffe6f1;color:#ff4f96;padding:6px 10px;border-radius:999px;font-weight:700}
    .muted{color:var(--muted)}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .row>*{flex:1 1 220px}
    label{display:block;font-size:.9rem;margin:6px 0}
    input,select{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #e8d4df;background:#fff}
    button{padding:12px 16px;border:none;border-radius:14px;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
    button.secondary{background:#eee;color:#333}
    button.danger{background:var(--danger)}
    button.ok{background:var(--ok)} button.snooze{background:var(--warn)}
    .list{display:grid;grid-template-columns:1fr;gap:12px}
    .pill{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px;border:1px solid #f4d7e5;border-radius:14px}
    .pill h4{margin:0;font-size:1rem}
    .actions{display:flex;gap:8px;flex-wrap:wrap}

    .tools{display:flex;gap:8px;align-items:center}
    .spacer{flex:1}
    .tiny{font-size:.85rem}

    /* kÃ¼Ã§Ã¼k kalp serpiÅŸtirme (daha ÅŸÄ±k) */
    .confetti {
      position: fixed; inset:0; pointer-events:none; opacity:.20;
      background-image:
        radial-gradient(circle 3px, #ff6fa3 99%, transparent 100%),
        radial-gradient(circle 3px, var(--heart-orange) 99%, transparent 100%);
      background-size: 160px 120px, 200px 140px;
      background-position: 20px 40px, 100px 10px;
      mix-blend-mode: multiply;
    }
  </style>
</head>
<body>
  <div class="confetti" aria-hidden="true"></div>

  <div class="app">
    <div class="card">
      <div class="title">
        <div class="brand">Ä°laÃ§larÄ±nÄ± Unutma ğŸ˜<span class="heart">ğŸ§¡</span></div>
        <span class="badge">PWA</span>
        <div class="tools">
          <label class="tiny" for="lang">Dil/Language</label>
          <select id="lang" aria-label="Dil / Language">
            <option value="tr" selected>TÃ¼rkÃ§e</option>
            <option value="en">English</option>
          </select>
          <label class="tiny" for="tz">Saat dilimi</label>
          <select id="tz" aria-label="Time zone">
            <option value="local" selected>Cihaz (Local)</option>
            <option value="UTC">UTC</option>
            <option value="Europe/Istanbul">Europe/Istanbul</option>
            <option value="Europe/London">Europe/London</option>
            <option value="America/New_York">America/New_York</option>
            <option value="Asia/Dubai">Asia/Dubai</option>
          </select>
        </div>
        <div class="spacer"></div>
      </div>
      <p class="muted" id="strap">Kendine iyi bak. Ä°lacÄ±n zamanÄ± geldi.</p>
      <p class="muted" id="dailyQuote" style="font-weight:600"></p>
    </div>

    <div class="card" id="formCard">
      <h3 id="addTitle">Ä°laÃ§ Ekle</h3>
      <div class="row">
        <div>
          <label for="name">Ä°laÃ§ adÄ± / Medication</label>
          <input id="name" placeholder="Ã–rn: Metformin 500 mg">
        </div>
        <div>
          <label for="time">Saat (24s)</label>
          <input id="time" type="time">
        </div>
        <div>
          <label for="repeat">Tekrar</label>
          <select id="repeat">
            <option value="daily">Her gÃ¼n / Daily</option>
            <option value="every12">12 saatte bir / q12h</option>
            <option value="every8">8 saatte bir / q8h</option>
            <option value="weekly">HaftalÄ±k / Weekly</option>
          </select>
        </div>
      </div>
      <div class="row">
        <div>
          <label for="notes">Not (opsiyonel) / Notes</label>
          <input id="notes" placeholder="AÃ§ tok / with meal...">
        </div>
      </div>
      <div class="row">
        <button id="save">Kaydet</button>
        <button id="clear" class="secondary">Temizle</button>
      </div>
    </div>

    <div class="card">
      <h3 id="listTitle">HatÄ±rlatÄ±cÄ±lar</h3>
      <div id="empty" class="muted">HenÃ¼z hatÄ±rlatÄ±cÄ± yok.</div>
      <div class="list" id="list"></div>
    </div>

    <p class="tiny muted">
      iOSâ€™ta web bildirimleri, uygulama aÃ§Ä±kken ve izin verildiÄŸinde Ã§alÄ±ÅŸÄ±r. PWA olarak Ana Ekrana ekleyip aÃ§Ä±k bÄ±rakmanÄ±z gerekir.
    </p>
  </div>

  <audio id="ding" preload="auto" src="./sounds/chime.mp3"></audio>

  <script>
    /* === i18n & sÃ¶zler === */
    const STR = {
      tr:{strap:"Kendine iyi bak. Ä°lacÄ±n zamanÄ± geldi.", add:"Ä°laÃ§ Ekle", list:"HatÄ±rlatÄ±cÄ±lar",
          empty:"HenÃ¼z hatÄ±rlatÄ±cÄ± yok.", taken:"AldÄ±m âœ… ğŸ®ğŸ™‚", snooze:"Ertele â° ğŸ®ğŸ™",
          edit:"DÃ¼zenle", del:"Sil ğŸ—‘ï¸", save:"Kaydet", clear:"Temizle"},
      en:{strap:"Take care. Itâ€™s time for your medicine.", add:"Add Medication", list:"Reminders",
          empty:"No reminders yet.", taken:"Taken âœ… ğŸ®ğŸ™‚", snooze:"Snooze â° ğŸ®ğŸ™",
          edit:"Edit", del:"Delete ğŸ—‘ï¸", save:"Save", clear:"Clear"}
    };
    const QUOTES_TR = [
      "Seni seviyorum! Ä°yi ki varsÄ±n!", "Ben yaparÄ±m, ÅŸov olur!",
      "Ä°lacÄ± iÃ§erim; erteleme yavrum!", "Ã‡ekilme; al onu!", "BugÃ¼n kendin iÃ§in bir adÄ±m at."
    ];
    const QUOTES_EN = [
      "I love youâ€”so glad you exist!", "Iâ€™ll do itâ€”showtime!",
      "Donâ€™t delayâ€”take it now!", "Donâ€™t back offâ€”take it!", "One small step for yourself today."
    ];

    /* === helpers === */
    const $ = s => document.querySelector(s);
    const listEl = $('#list'), emptyEl=$('#empty'), langSel=$('#lang'), tzSel=$('#tz');

    function t(k){ return STR[langSel.value][k]; }
    function quote(){ return (langSel.value==='tr'?QUOTES_TR:QUOTES_EN)[Math.floor(Math.random()*5)] }

    // time helpers (tz aware display; alarm yine cihaz saatine gÃ¶re tetiklenir)
    function nowMinutes(){ const d=new Date(); return d.getHours()*60 + d.getMinutes(); }
    function fmtTimeHM(hhmm){
      const [h,m]=hhmm.split(':').map(Number);
      const d=new Date(); d.setHours(h,m,0,0);
      try{
        const tz = tzSel.value==='local'? Intl.DateTimeFormat().resolvedOptions().timeZone : tzSel.value;
        return new Intl.DateTimeFormat(langSel.value, {hour:'2-digit',minute:'2-digit',hour12:false,timeZone:tz}).format(d);
      }catch(e){ return hhmm; }
    }

    function saveStore(items){ localStorage.setItem('meds', JSON.stringify(items)); }
    function loadStore(){ try{return JSON.parse(localStorage.getItem('meds')||'[]')}catch(e){return []} }
    function savePrefs(){ localStorage.setItem('prefs', JSON.stringify({lang:langSel.value,tz:tzSel.value})) }
    function loadPrefs(){ try{return JSON.parse(localStorage.getItem('prefs')||'{}')}catch(e){return {}} }

    /* === render === */
    function render(){
      const items = loadStore();
      listEl.innerHTML='';
      emptyEl.style.display = items.length? 'none':'block';

      items.forEach((it,idx)=>{
        const card = document.createElement('div'); card.className='pill';
        const left = document.createElement('div');
        left.innerHTML = `<h4>${it.name}</h4>
          <div class="muted">${fmtTimeHM(it.time)} â€¢ ${it.repeat}${it.notes? ' â€¢ '+it.notes:''}</div>`;

        const actions = document.createElement('div'); actions.className='actions';
        const ok=document.createElement('button'); ok.className='ok'; ok.textContent=t('taken');
        const sn=document.createElement('button'); sn.className='snooze'; sn.textContent=t('snooze');
        const ed=document.createElement('button'); ed.textContent=t('edit');
        const dl=document.createElement('button'); dl.className='danger'; dl.textContent=t('del'); // ğŸ—‘ï¸

        actions.append(ok,sn,ed,dl); card.append(left,actions); listEl.append(card);
        ok.onclick=()=>markTaken(idx);
        sn.onclick=()=>snooze(idx,10);
        ed.onclick=()=>editItem(idx);
        dl.onclick=()=>delItem(idx);
      });

      $('#strap').textContent = t('strap');
      $('#addTitle').textContent = t('add');
      $('#listTitle').textContent = t('list');
      $('#save').textContent = t('save');
      $('#clear').textContent = t('clear');
      emptyEl.textContent = t('empty');
      $('#dailyQuote').textContent = quote();
    }

    /* === CRUD === */
    function addItem(){
      const name=$('#name').value.trim();
      const time=$('#time').value;
      if(!name||!time) return alert('Ä°sim ve saat gerekli / Name and time required');
      const notes=$('#notes').value.trim();
      const repeat=$('#repeat').value;
      const items=loadStore();
      items.push({name,time,repeat,notes,nextDue:time,snoozeUntil:null});
      saveStore(items); render();
      $('#name').value=''; $('#time').value=''; $('#notes').value='';
    }
    function editItem(i){
      const items=loadStore(); const it=items[i];
      $('#name').value=it.name; $('#time').value=it.time; $('#notes').value=it.notes||''; $('#repeat').value=it.repeat;
      items.splice(i,1); saveStore(items); render();
    }
    function delItem(i){ const items=loadStore(); items.splice(i,1); saveStore(items); render(); }

    function nextDueFrom(it){
      const [hh,mm]=it.time.split(':').map(Number);
      const base = new Date(); base.setHours(hh,mm,0,0);
      if(it.repeat==='every8') base.setHours(base.getHours()+8);
      else if(it.repeat==='every12') base.setHours(base.getHours()+12);
      else if(it.repeat==='weekly') base.setDate(base.getDate()+7);
      else base.setDate(base.getDate()+1);
      return base.toTimeString().slice(0,5);
    }
    function markTaken(i){
      const items=loadStore(); const it=items[i];
      it.snoozeUntil=null; it.nextDue = nextDueFrom(it);
      saveStore(items); render();
    }
    function snooze(i, minutes){
      const items=loadStore(); const it=items[i];
      const d=new Date(); d.setMinutes(d.getMinutes()+minutes);
      it.snoozeUntil = `${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
      saveStore(items); render();
    }

    /* === notifications === */
    async function ensurePerms(){
      try { if('Notification' in window && Notification.permission!=='granted') await Notification.requestPermission(); }
      catch(e){}
    }
    function notify(it){
      const quoteLine = $('#dailyQuote').textContent || quote();
      const body = `${it.name} â€¢ ${fmtTimeHM(it.time)}\n${quoteLine}`;
      try{
        new Notification('Ä°laÃ§larÄ±nÄ± Unutma ğŸ˜ğŸ§¡', { body, icon:'./icons/icon-192.png', tag: it.name });
      }catch(e){ alert(body); }
      const ding=$('#ding'); ding.currentTime=0; ding.play().catch(()=>{});
    }
    function tick(){
      const items=loadStore(); if(!items.length) return;
      const mins = nowMinutes();
      items.forEach((it)=>{
        const due = it.snoozeUntil || it.nextDue || it.time;
        const [hh,mm] = due.split(':').map(Number);
        const dueM = hh*60+mm;
        if(dueM === mins){
          notify(it);
          it.snoozeUntil=null;
          it.nextDue = nextDueFrom(it);
        }
      });
      saveStore(items);
    }

    /* === boot === */
    (function init(){
      const prefs=loadPrefs(); if(prefs.lang) langSel.value=prefs.lang; if(prefs.tz) tzSel.value=prefs.tz;
      langSel.onchange = ()=>{ savePrefs(); render(); };
      tzSel.onchange = ()=>{ savePrefs(); render(); };

      $('#save').onclick=addItem;
      $('#clear').onclick=()=>{ $('#name').value=''; $('#time').value=''; $('#notes').value=''; };

      ensurePerms();
      render();
      setInterval(tick, 60*1000);

      if('serviceWorker' in navigator){
        window.addEventListener('load', ()=>{ navigator.serviceWorker.register('./sw.js'); });
      }
    })();
  </script>
</body>
</html>

